#!/usr/bin/env bash

# Retrieve (among other things) a server's SSL cert fingerprint

# Primarily useful for querying POP3 machines: the fingerprint
# is used in ~/.fetchmailrc to set up SSL retrievals.

# However, as the vars below can be overwritten (both here and
# on the command line), other combinations are possible.

# The author's preferred way of retrieving messages.
SERVER="pop.gmx.net"

# POP3 over SSL.
PORT=995

# The default is a SHA1 hash.  Fetchmail wants MD5.
FORMAT="-md5"

exec \
   openssl \
      s_client \
      -connect ${SERVER}:${PORT} \
      -servername ${SERVER} \
      -showcerts | \
   openssl \
      x509 \
      -text \
      -noout \
      ${FORMAT} \
      -fingerprint \
